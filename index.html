<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>نوژشاپ — فروشگاه لوازم آرایشی و بهداشتی</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
<style>
  :root{--brand:#d63384}
  body{font-family:Tahoma, sans-serif;background:#f9f9fb;margin:0;padding-bottom:80px}
  header{background:var(--brand);color:#fff;padding:1rem;text-align:center}
  .hamburger{position:absolute;left:12px;top:14px;width:34px;cursor:pointer}
  .hamburger span{display:block;height:3px;background:#fff;margin:5px 0;border-radius:3px}
  .product-img{height:200px;object-fit:cover;border-radius:10px}
  .thumb{width:72px;height:52px;object-fit:cover;border-radius:6px;margin-left:8px}
  footer{background:var(--brand);color:#fff;padding:14px 8px;position:fixed;left:0;right:0;bottom:0}
  .container-main{max-width:1100px;margin:auto;padding:18px}
  .admin-hidden{display:none}
  @media(max-width:700px){ .product-img{height:160px} }
</style>
</head>
<body>

<header>
  <div class="hamburger" id="hamburger" title="منو">
    <span></span><span></span><span></span>
  </div>
  <h1 style="margin:0">نوژشاپ</h1>
  <div style="font-size:.95rem;margin-top:6px">فروشگاه لوازم آرایشی و بهداشتی</div>
</header>

<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
  <div class="container container-main d-flex justify-content-between align-items-center">
    <div>
      <a class="navbar-brand" href="#" id="navHome">نوژشاپ</a>
    </div>
    <div>
      <button class="btn btn-outline-secondary btn-sm me-2" id="showProductsBtn">محصولات</button>
      <button class="btn btn-outline-secondary btn-sm me-2" id="showContactBtn">تماس با ما</button>
      <button class="btn btn-outline-danger btn-sm" id="showAdminBtn">مدیریت سایت</button>
    </div>
  </div>
</nav>

<main class="container-main">

  <!-- welcome -->
  <section id="homeSection" class="my-4 text-center">
    <h2>خوش آمدید به نوژشاپ</h2>
    <p style="max-width:800px;margin:auto;color:#444">
      در نوژشاپ ما تلاش می‌کنیم بهترین محصولات آرایشی و بهداشتی را با قیمت منصفانه و پشتیبانی صمیمانه ارائه دهیم.
      اگر خواستی محصول جدید اضافه کنی یا عکس را تغییر دهی، وارد پنل مدیریت شو — رمز ورود فقط برای تو محفوظ است.
    </p>
  </section>

  <!-- products -->
  <section id="productsSection" class="mb-4">
    <h3 class="text-center mb-3">محصولات ما</h3>
    <div class="row g-4" id="productsGrid"></div>
  </section>

  <!-- order form (inline section that appears when user clicks خرید) -->
  <section id="orderSection" class="admin-hidden mb-4">
    <h4 class="text-center">ثبت سفارش</h4>
    <form id="orderForm" class="mx-auto" style="max-width:600px">
      <div class="mb-2">
        <label class="form-label">محصول</label>
        <input id="orderProduct" class="form-control" readonly />
      </div>
      <div class="mb-2 row">
        <div class="col-md-6">
          <label class="form-label">قیمت واحد (تومان)</label>
          <input id="orderPrice" class="form-control" readonly />
        </div>
        <div class="col-md-6">
          <label class="form-label">تعداد</label>
          <input id="orderQty" type="number" min="1" value="1" class="form-control" required />
        </div>
      </div>
      <div class="mb-2">
        <label class="form-label">نام و نام خانوادگی</label>
        <input id="custName" class="form-control" required minlength="3" />
      </div>
      <div class="mb-2">
        <label class="form-label">شماره تماس</label>
        <input id="custPhone" class="form-control" required pattern="^[0-9]{10,15}$" />
      </div>
      <div class="mb-2">
        <label class="form-label">آدرس کامل</label>
        <textarea id="custAddress" rows="2" class="form-control" required minlength="5"></textarea>
      </div>
      <div class="mb-2">
        <label class="form-label">کد پستی (۱۰ رقم)</label>
        <input id="custPostal" class="form-control" required pattern="^[0-9]{10}$" />
      </div>
      <div class="d-grid gap-2 mt-2">
        <button type="submit" class="btn btn-success">ثبت و پرداخت</button>
        <button type="button" id="cancelOrder" class="btn btn-outline-secondary">انصراف</button>
      </div>
    </form>
  </section>

  <!-- contact -->
  <section id="contactSection" class="mb-4 admin-hidden text-center">
    <h3>تماس با ما</h3>
    <p>برای سفارش یا هر سوالی در تلگرام پیام بدید:</p>
    <a href="https://t.me/noj1385" class="btn btn-primary" target="_blank">@noj1385</a>
  </section>

  <!-- ADMIN LOGIN & PANEL -->
  <section id="adminSection" class="admin-hidden">
    <div id="adminLogin" class="mx-auto" style="max-width:420px">
      <h4 class="text-center">ورود مدیر</h4>
      <div class="mb-2">
        <input id="adminPassInput" type="password" class="form-control" placeholder="رمز مدیر را وارد کنید" />
      </div>
      <div class="d-grid">
        <button id="adminLoginBtn" class="btn btn-danger">ورود</button>
      </div>
      <p id="adminLoginMsg" class="text-danger text-center mt-2"></p>
    </div>

    <div id="adminPanel" class="admin-hidden mt-4">
      <h4>پنل مدیریت</h4>

      <!-- add product -->
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">افزودن محصول جدید</h5>
          <form id="addProductForm" class="row g-2 align-items-end">
            <div class="col-12 col-md-4">
              <label class="form-label">نام محصول</label>
              <input id="pName" class="form-control" required />
            </div>
            <div class="col-12 col-md-3">
              <label class="form-label">قیمت (تومان)</label>
              <input id="pPrice" type="number" min="1" class="form-control" required />
            </div>
            <div class="col-12 col-md-3">
              <label class="form-label">عکس (آپلود یا لینک)</label>
              <input id="pFile" type="file" accept="image/*" class="form-control" />
              <input id="pLink" type="url" class="form-control mt-1" placeholder="یا آدرس مستقیم تصویر (اختیاری)" />
              <div class="form-text">اگر فایل انتخاب کنید، فایل آپلودی استفاده می‌شود. در غیر این صورت لینک استفاده می‌شود.</div>
            </div>
            <div class="col-12 col-md-2">
              <button class="btn btn-success w-100" id="addProductBtn">افزودن</button>
            </div>
          </form>
        </div>
      </div>

      <!-- manage products -->
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">محصولات (ویرایش / حذف)</h5>
          <ul id="adminProducts" class="list-group list-group-flush"></ul>
        </div>
      </div>

      <!-- manage orders -->
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">سفارشات ثبت‌شده</h5>
          <ul id="adminOrders" class="list-group list-group-flush"></ul>
        </div>
      </div>

      <div class="d-flex gap-2">
        <button id="adminLogout" class="btn btn-secondary">خروج از مدیریت</button>
        <button id="resetDataBtn" class="btn btn-outline-danger">بازیابی محصولات پیش‌فرض</button>
      </div>
    </div>
  </section>

</main>

<footer>
  <div class="container container-main d-flex justify-content-center align-items-center gap-3 flex-wrap">
    <img src="https://trustseal.enamad.ir/logo.aspx?id=124674&amp;Code=e5LfFkIfiWLnlq2FrP01" alt="نماد اعتماد" style="height:44px" />
    <div>© ۲۰۲۵ نوژشاپ — تمامی حقوق محفوظ است</div>
  </div>
</footer>

<!-- SCRIPT -->
<script>
/* -----------------------
  کل کد در این فایل:
  - ذخیره محصولات/سفارشات در localStorage
  - آپلود عکس از کامپیوتر با FileReader -> dataURL
  - مدیریت (ورود با رمز: 12251551)
  - فرم سفارش کامل و اعتبارسنجی
  - هدایت به زرین‌پال (merchant_id را جایگزین کن)
------------------------*/

const ADMIN_PASS = "12251551";
const LS_PRODUCTS = "noj_products_v2";
const LS_ORDERS = "noj_orders_v2";

/* default products (6) */
const DEFAULT_PRODUCTS = [
  {id:1, title:"کرم مرطوب‌کننده", price:250000, image:"https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=800&q=60"},
  {id:2, title:"رژ لب مایع مات", price:150000, image:"https://images.unsplash.com/photo-1600180758890-9b6b6a7ef7c9?auto=format&fit=crop&w=800&q=60"},
  {id:3, title:"سرم ویتامین C", price:320000, image:"https://images.unsplash.com/photo-1575936123452-b67c3203c357?auto=format&fit=crop&w=800&q=60"},
  {id:4, title:"ادو پرفیوم زنانه", price:400000, image:"https://images.unsplash.com/photo-1542831371-29b0f74f9713?auto=format&fit=crop&w=800&q=60"},
  {id:5, title:"ماسک صورت", price:180000, image:"https://images.unsplash.com/photo-1516054712743-7a2fc0e960f3?auto=format&fit=crop&w=800&q=60"},
  {id:6, title:"لاک ناخن رنگی", price:90000, image:"https://images.unsplash.com/photo-1501004318641-b39e6451bec6?auto=format&fit=crop&w=800&q=60"}
];

let products = [];
let orders = [];
let selectedProduct = null;

/* helpers */
function saveProducts(){ localStorage.setItem(LS_PRODUCTS, JSON.stringify(products)); }
function loadProducts(){
  const s = localStorage.getItem(LS_PRODUCTS);
  products = s ? JSON.parse(s) : DEFAULT_PRODUCTS.slice();
}
function saveOrders(){ localStorage.setItem(LS_ORDERS, JSON.stringify(orders)); }
function loadOrders(){ const s = localStorage.getItem(LS_ORDERS); orders = s ? JSON.parse(s) : []; }
function numberWithCommas(x){ return String(x).replace(/\B(?=(\d{3})+(?!\d))/g, ","); }
function el(id){ return document.getElementById(id); }

/* initial load */
loadProducts(); loadOrders();

/* UI refs */
const productsGrid = el("productsGrid");
const orderSection = el("orderSection");
const orderForm = el("orderForm");
const adminSection = el("adminSection");
const adminLogin = el("adminLogin");
const adminPanel = el("adminPanel");
const adminProductsList = el("adminProducts");
const adminOrdersList = el("adminOrders");

/* show/hide sections buttons */
el("showProductsBtn").onclick = ()=>{ scrollToSection(el("productsSection")); }
el("showContactBtn").onclick = ()=>{ scrollToSection(el("contactSection")); }
el("showAdminBtn").onclick = ()=>{ scrollToSection(el("adminSection")); el("adminPassInput").focus(); }

/* render products */
function renderProducts(){
  productsGrid.innerHTML = "";
  products.forEach(p=>{
    const col = document.createElement("div");
    col.className = "col-12 col-md-4";
    col.innerHTML = `
      <div class="card h-100 shadow-sm">
        <img src="${escapeHtml(p.image)}" class="card-img-top product-img" alt="${escapeHtml(p.title)}" onerror="this.src='https://via.placeholder.com/800x600?text=No+Image'"/>
        <div class="card-body text-center">
          <h5 class="card-title">${escapeHtml(p.title)}</h5>
          <p class="card-text text-danger fw-bold">${numberWithCommas(p.price)} تومان</p>
          <div class="d-flex justify-content-center gap-2">
            <button class="btn btn-success btn-sm buyBtn" data-id="${p.id}">خرید</button>
          </div>
        </div>
      </div>
    `;
    productsGrid.appendChild(col);
  });
  document.querySelectorAll(".buyBtn").forEach(b=>b.onclick = (e)=> startOrder(Number(e.currentTarget.dataset.id)));
}

/* start order -> show inline form populated */
function startOrder(productId){
  selectedProduct = products.find(x=>x.id===productId);
  if(!selectedProduct){ alert("محصول پیدا نشد"); return; }
  el("orderProduct").value = selectedProduct.title;
  el("orderPrice").value = selectedProduct.price;
  el("orderQty").value = 1;
  el("custName").value = "";
  el("custPhone").value = "";
  el("custAddress").value = "";
  el("custPostal").value = "";
  orderSection.classList.remove("admin-hidden");
  scrollToSection(orderSection);
}

/* cancel order */
el("cancelOrder").onclick = ()=>{ orderSection.classList.add("admin-hidden"); };

/* submit order -> validate and redirect to Zarinpal */
orderForm.onsubmit = function(e){
  e.preventDefault();
  if(!selectedProduct){ alert("هیچ محصولی انتخاب نشده"); return; }
  const qty = parseInt(el("orderQty").value);
  if(isNaN(qty) || qty < 1){ alert("تعداد باید حداقل 1 باشد"); return; }
  const name = el("custName").value.trim();
  const phone = el("custPhone").value.trim();
  const address = el("custAddress").value.trim();
  const postal = el("custPostal").value.trim();
  if(name.length < 3){ alert("نام باید حداقل ۳ حرف باشد"); return; }
  if(!/^[0-9]{10,15}$/.test(phone)){ alert("شماره تماس معتبر نیست"); return; }
  if(address.length < 5){ alert("آدرس کامل را وارد کنید"); return; }
  if(!/^[0-9]{10}$/.test(postal)){ alert("کد پستی باید ۱۰ رقم باشد"); return; }

  const total = selectedProduct.price * qty;
  const order = {
    id: Date.now(),
    productId: selectedProduct.id,
    productTitle: selectedProduct.title,
    unitPrice: selectedProduct.price,
    qty, total,
    name, phone, address, postal,
    created: new Date().toISOString()
  };
  orders.push(order); saveOrders();
  alert(`سفارش ثبت شد — مبلغ ${numberWithCommas(total)} تومان\nبه صفحه پرداخت هدایت می‌شوید.`);

  // redirect to Zarinpal (replace merchant_id with your real merchant id)
  const merchant_id = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx";
  const description = encodeURIComponent(`خرید ${qty} عدد ${selectedProduct.title} — نوژشاپ`);
  // Note: official Zarinpal flow requires server-side request for payment token.
  // Here we open StartPay placeholder. Replace with real server integration later.
  const amount = total;
  const payUrl = `https://www.zarinpal.com/pg/StartPay/${merchant_id}?amount=${amount}&description=${description}`;
  window.open(payUrl, "_blank");

  orderSection.classList.add("admin-hidden");
  renderAdminOrders();
};

/* ADMIN: login */
el("adminLoginBtn").onclick = ()=>{
  const pass = el("adminPassInput").value || "";
  if(pass === ADMIN_PASS){
    el("adminLogin").classList.add("admin-hidden");
    el("adminPanel").classList.remove("admin-hidden");
    renderAdminProducts(); renderAdminOrders();
    el("adminPassInput").value = "";
    scrollToSection(el("adminSection"));
  } else {
    el("adminLoginMsg").textContent = "رمز اشتباه است.";
  }
};

/* ADMIN: logout */
el("adminLogout").onclick = ()=>{
  el("adminPanel").classList.add("admin-hidden");
  el("adminLogin").classList.remove("admin-hidden");
  el("adminLoginMsg").textContent = "";
};

/* Add product: handle file upload or link */
el("addProductBtn").onclick = async (ev)=>{
  ev.preventDefault();
  const name = el("pName").value.trim();
  const price = Number(el("pPrice").value);
  const fileInput = el("pFile");
  const link = el("pLink").value.trim();
  if(!name || !price || (fileInput.files.length === 0 && !link)){
    alert("لطفاً نام، قیمت و تصویر (آپلود یا لینک) را وارد کنید.");
    return;
  }
  let image = "";
  if(fileInput.files.length > 0){
    try {
      image = await fileToDataURL(fileInput.files[0]);
    } catch(err){ console.error(err); alert("خطا در خواندن فایل تصویر"); return; }
  } else {
    image = link;
  }
  const newId = products.length ? Math.max(...products.map(p=>p.id))+1 : 1;
  products.push({id:newId, title:name, price, image});
  saveProducts();
  renderProducts(); renderAdminProducts();
  el("pName").value = ""; el("pPrice").value = ""; el("pFile").value = ""; el("pLink").value = "";
  alert("محصول اضافه شد.");
};

/* Convert file to DataURL */
function fileToDataURL(file){
  return new Promise((res, rej)=>{
    const fr = new FileReader();
    fr.onload = ()=> res(fr.result);
    fr.onerror = ()=> rej(new Error("File read error"));
    fr.readAsDataURL(file);
  });
}

/* Render admin products (editable) */
function renderAdminProducts(){
  adminProductsList.innerHTML = "";
  if(!products.length){
    adminProductsList.innerHTML = "<li class='list-group-item text-center'>محصولی وجود ندارد</li>";
    return;
  }
  products.forEach(p=>{
    const li = document.createElement("li");
    li.className = "list-group-item d-flex flex-column gap-2";
    li.innerHTML = `
      <div class="d-flex align-items-start gap-3">
        <img src="${escapeHtml(p.image)}" class="thumb" onerror="this.src='https://via.placeholder.com/150x100?text=No+Image'"/>
        <div style="flex:1">
          <input class="form-control mb-1 prod-title" data-id="${p.id}" value="${escapeHtml(p.title)}" />
          <input class="form-control mb-1 prod-price" data-id="${p.id}" type="number" min="1" value="${p.price}" />
          <div class="d-flex gap-2">
            <input class="form-control prod-link" data-id="${p.id}" placeholder="یا لینک تصویر مستقیم" value="${escapeHtml(p.image)}" />
            <input class="form-control form-control-sm prod-file" data-id="${p.id}" type="file" accept="image/*" />
          </div>
        </div>
      </div>
      <div class="d-flex gap-2 justify-content-end">
        <button class="btn btn-sm btn-success save-prod" data-id="${p.id}">ذخیره</button>
        <button class="btn btn-sm btn-danger del-prod" data-id="${p.id}">حذف</button>
      </div>
    `;
    adminProductsList.appendChild(li);
  });

  // attach handlers
  adminProductsList.querySelectorAll(".del-prod").forEach(btn=>{
    btn.onclick = ()=>{
      const id = Number(btn.dataset.id);
      if(!confirm("آیا از حذف محصول مطمئن هستید؟")) return;
      products = products.filter(x=>x.id!==id);
      saveProducts(); renderProducts(); renderAdminProducts();
    };
  });

  adminProductsList.querySelectorAll(".save-prod").forEach(btn=>{
    btn.onclick = async ()=>{
      const id = Number(btn.dataset.id);
      const titleInput = adminProductsList.querySelector(`.prod-title[data-id='${id}']`);
      const priceInput = adminProductsList.querySelector(`.prod-price[data:id='${id}'], .prod-price[data-id='${id}']`);
      const linkInput = adminProductsList.querySelector(`.prod-link[data-id='${id}']`);
      const fileInput = adminProductsList.querySelector(`.prod-file[data-id='${id}']`);
      const title = titleInput.value.trim();
      const price = Number(priceInput.value);
      if(!title || !price){ alert("عنوان و قیمت را تکمیل کنید"); return; }
      let image = linkInput.value.trim();
      if(fileInput.files && fileInput.files.length>0){
        try{ image = await fileToDataURL(fileInput.files[0]); } catch(err){ alert("خطا در خواندن فایل"); return; }
      }
      const idx = products.findIndex(x=>x.id===id);
      if(idx>-1){
        products[idx].title = title;
        products[idx].price = price;
        products[idx].image = image;
        saveProducts(); renderProducts(); renderAdminProducts();
        alert("محصول ذخیره شد");
      }
    };
  });
}

/* Render admin orders */
function renderAdminOrders(){
  adminOrdersList.innerHTML = "";
  if(!orders.length){
    adminOrdersList.innerHTML = "<li class='list-group-item text-center'>سفارشی ثبت نشده</li>";
    return;
  }
  orders.slice().reverse().forEach(o=>{
    const li = document.createElement("li");
    li.className = "list-group-item d-flex flex-column gap-2";
    li.innerHTML = `
      <div><b>${escapeHtml(o.productTitle)}</b> — تعداد: ${o.qty} — مبلغ کل: ${numberWithCommas(o.total)} تومان</div>
      <div><b>نام:</b> ${escapeHtml(o.name)} — <b>تلفن:</b> ${escapeHtml(o.phone)}</div>
      <div><b>آدرس:</b> ${escapeHtml(o.address)} — <b>کد پستی:</b> ${escapeHtml(o.postal)}</div>
      <div class="d-flex gap-2 justify-content-end">
        <button class="btn btn-sm btn-danger del-order" data-id="${o.id}">حذف سفارش</button>
      </div>
    `;
    adminOrdersList.appendChild(li);
  });

  adminOrdersList.querySelectorAll(".del-order").forEach(btn=>{
    btn.onclick = ()=>{
      const id = Number(btn.dataset.id);
      if(!confirm("آیا از حذف این سفارش مطمئن هستید؟")) return;
      orders = orders.filter(x=>x.id!==id);
      saveOrders(); renderAdminOrders();
    };
  });
}

/* reset products to defaults */
el("resetDataBtn").onclick = ()=>{
  if(!confirm("محصولات فعلی پاک و محصولات پیش‌فرض بارگذاری شوند؟")) return;
  products = DEFAULT_PRODUCTS.slice(); saveProducts(); renderProducts(); re
