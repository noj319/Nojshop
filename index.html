<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>نوژشاپ - فروشگاه لوازم آرایشی و بهداشتی</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <style>
    body { background: #f9f9fb; font-family: "Tahoma", sans-serif; }
    header, footer { background-color: #d63384; color: white; padding: 1rem 0; }
    .product-img { height: 200px; object-fit: cover; border-radius: 10px; }
    .trust-logo { height: 60px; margin-left: 15px; }
    nav a.nav-link.active { font-weight: bold; color: #d63384 !important; }
    #adminPanel { display: none; }
    #loginPanel { max-width: 400px; margin: 2rem auto; }
  </style>
</head>
<body>

<header class="text-center">
  <h1>نوژشاپ</h1>
  <p>فروشگاه آنلاین لوازم آرایشی و بهداشتی</p>
</header>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container">
    <a class="navbar-brand" href="#home">نوژشاپ</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
      aria-controls="navbarNav" aria-expanded="false" aria-label="نمایش فهرست">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link active" href="#home">خانه</a></li>
        <li class="nav-item"><a class="nav-link" href="#products">محصولات</a></li>
        <li class="nav-item"><a class="nav-link" href="#contact">تماس با ما</a></li>
        <li class="nav-item"><a class="nav-link" href="#" id="adminBtn">مدیریت سایت</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container my-4">

  <!-- بخش خانه -->
  <section id="home" class="mb-5 text-center">
    <h2>به نوژشاپ خوش آمدید!</h2>
    <p style="max-width: 600px; margin: auto; font-size: 1.1rem; color: #555;">
      تو نوژشاپ، ما باور داریم زیبایی حق همه‌ست.  
      محصولات باکیفیت و تازه‌ترین برندهای آرایشی و بهداشتی رو با قیمت مناسب براتون فراهم کردیم.  
      تیم ما همیشه آماده‌ست تا بهترین‌ها رو به دست شما برسونه و تجربه خریدی راحت و لذت‌بخش داشته باشید.  
      با نوژشاپ، درخشش و سلامت پوست و مو رو به خودتون هدیه بدید!  
    </p>
  </section>

  <!-- بخش محصولات -->
  <section id="products" class="mb-5">
    <h2 class="mb-4 text-center">محصولات ما</h2>
    <div class="row g-4" id="productList">
      <!-- محصولات اینجا با JS اضافه میشن -->
    </div>
  </section>

  <!-- بخش سفارشات -->
  <section id="ordersSection" style="display:none;" class="mb-5">
    <h2 class="mb-4 text-center">سفارشات ثبت شده</h2>
    <ul class="list-group" id="orderList">
      <!-- سفارشات اینجا با JS اضافه میشن -->
    </ul>
  </section>

  <!-- بخش تماس با ما -->
  <section id="contact" class="mb-5 text-center">
    <h2>تماس با ما</h2>
    <p>برای سفارش و سوالات، در تلگرام با ما در ارتباط باشید:</p>
    <a href="https://t.me/noj1385" target="_blank" class="btn btn-primary">آیدی تلگرام: @noj1385</a>
  </section>

  <!-- پنل ورود مدیریت -->
  <section id="loginPanel">
    <h3 class="text-center">ورود مدیریت</h3>
    <input type="password" id="adminPassword" class="form-control mb-3" placeholder="رمز عبور را وارد کنید" />
    <button id="loginBtn" class="btn btn-danger w-100">ورود</button>
    <p id="loginError" class="text-danger mt-2" style="display:none;">رمز عبور اشتباه است.</p>
  </section>

  <!-- پنل مدیریت -->
  <section id="adminPanel" class="mb-5">
    <h2 class="mb-4 text-center">پنل مدیریت</h2>

    <!-- فرم افزودن محصول -->
    <div class="mb-4">
      <h4>افزودن محصول جدید</h4>
      <input type="text" id="newTitle" class="form-control mb-2" placeholder="نام محصول" />
      <input type="text" id="newPrice" class="form-control mb-2" placeholder="قیمت (تومان)" />
      <input type="text" id="newImage" class="form-control mb-2" placeholder="لینک تصویر" />
      <button id="addProductBtn" class="btn btn-success">افزودن محصول</button>
    </div>

    <!-- لیست محصولات قابل حذف و ویرایش -->
    <div>
      <h4>مدیریت محصولات</h4>
      <ul class="list-group" id="manageProductList"></ul>
    </div>

    <!-- لیست سفارشات قابل حذف -->
    <div class="mt-4">
      <h4>سفارشات ثبت شده</h4>
      <ul class="list-group" id="manageOrderList"></ul>
    </div>

    <button id="logoutBtn" class="btn btn-secondary mt-4">خروج از مدیریت</button>
  </section>

</main>

<footer class="text-center">
  <div class="container d-flex justify-content-center align-items-center flex-wrap">
    <img src="https://trustseal.enamad.ir/logo.aspx?id=124674&amp;Code=e5LfFkIfiWLnlq2FrP01" 
         alt="نماد اعتماد الکترونیکی" class="trust-logo" />
    <span>© ۲۰۲۵ نوژشاپ - تمامی حقوق محفوظ است</span>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  let products = [
    {id: 1, title: "کرم مرطوب‌کننده", price: "۲۵۰,۰۰۰ تومان", image: "https://cdn.pixabay.com/photo/2016/03/27/21/17/cosmetics-1284258_1280.jpg"},
    {id: 2, title: "رژ لب مایع مات", price: "۱۵۰,۰۰۰ تومان", image: "https://cdn.pixabay.com/photo/2018/03/06/22/20/lipstick-3209793_1280.jpg"},
    {id: 3, title: "سرم ویتامین C", price: "۳۲۰,۰۰۰ تومان", image: "https://cdn.pixabay.com/photo/2017/07/10/19/02/serum-2497527_1280.jpg"},
    {id: 4, title: "ادو پرفیوم زنانه", price: "۴۰۰,۰۰۰ تومان", image: "https://cdn.pixabay.com/photo/2016/11/18/16/40/perfume-1835611_1280.jpg"},
    {id: 5, title: "ماسک صورت", price: "۱۸۰,۰۰۰ تومان", image: "https://cdn.pixabay.com/photo/2017/12/10/14/47/facial-mask-3015523_1280.jpg"},
    {id: 6, title: "لاک ناخن رنگی", price: "۹۰,۰۰۰ تومان", image: "https://cdn.pixabay.com/photo/2016/03/23/20/26/nail-polish-1274889_1280.jpg"},
  ];

  let orders = [];

  const productList = document.getElementById("productList");
  const manageProductList = document.getElementById("manageProductList");
  const manageOrderList = document.getElementById("manageOrderList");
  const ordersSection = document.getElementById("ordersSection");
  const adminPanel = document.getElementById("adminPanel");
  const loginPanel = document.getElementById("loginPanel");
  const loginBtn = document.getElementById("loginBtn");
  const adminPasswordInput = document.getElementById("adminPassword");
  const loginError = document.getElementById("loginError");
  const adminBtn = document.getElementById("adminBtn");
  const logoutBtn = document.getElementById("logoutBtn");

  // نمایش محصولات
  function showProducts() {
    productList.innerHTML = "";
    products.forEach(p => {
      const div = document.createElement("div");
      div.className = "col-12 col-md-4";
      div.innerHTML = `
        <div class="card shadow-sm">
          <img src="${p.image}" class="card-img-top product-img" alt="${p.title}" />
          <div class="card-body text-center">
            <h5 class="card-title">${p.title}</h5>
            <p class="card-text text-danger fw-bold">${p.price}</p>
            <button class="btn btn-danger buyBtn" data-id="${p.id}">خرید</button>
          </div>
        </div>`;
      productList.appendChild(div);
    });
    document.querySelectorAll(".buyBtn").forEach(btn => {
      btn.onclick = e => {
        const id = parseInt(e.target.dataset.id);
        addOrder(id);
      };
    });
  }

  // فرم سفارش مودال و هدایت به زرین پال
  function addOrder(productId) {
    const product = products.find(p => p.id === productId);
    if(!product) return alert("محصول یافت نشد");

    const modalHtml = `
    <div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true" dir="rtl">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="orderModalLabel">ثبت سفارش - ${product.title}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
          </div>
          <div class="modal-body">
            <form id="orderForm">
              <div class="mb-3">
                <label for="customerName" class="form-label">نام و نام خانوادگی</label>
                <input type="text" class="form-control" id="customerName" required />
              </div>
              <div class="mb-3">
                <label for="customerPhone" class="form-label">شماره تماس</label>
                <input type="tel" class="form-control" id="customerPhone" required pattern="^[0-9]{10,15}$" title="فقط اعداد وارد کنید" />
              </div>
              <div class="mb-3">
                <label for="customerAddress" class="form-label">آدرس کامل</label>
                <textarea class="form-control" id="customerAddress" rows="2" required></textarea>
              </div>
              <div class="mb-3">
                <label for="customerPostal" class="form-label">کد پستی</label>
                <input type="text" class="form-control" id="customerPostal" required pattern="^[0-9]{10}$" title="کد پستی باید ۱۰ رقم باشد" />
              </div>
              <button type="submit" class="btn btn-success w-100">ثبت سفارش و پرداخت</button>
            </form>
          </div>
        </div>
      </div>
    </div>`;

    document.body.insertAdjacentHTML("beforeend", modalHtml);
    const orderModal = new bootstrap.Modal(document.getElementById('orderModal'));
    orderModal.show();

    document.getElementById("orderForm").onsubmit = function(e) {
      e.preventDefault();

      const name = document.getElementById("customerName").value.trim();
      const phone = document.getElementById("customerPhone").value.trim();
      const address = document.getElementById("customerAddress").value.trim();
      const postal = document.getElementById("customerPostal").value.trim();

      if(name.length < 3) return alert("نام باید حداقل ۳ حرف باشد.");
      if(!/^[0-9]{10,15}$/.test(phone)) return alert("شماره تماس معتبر نیست.");
      if(address.length < 5) return alert("آدرس کامل را وارد کنید.");
      if(!/^[0-9]{10}$/.test(postal)) return alert("کد پستی باید ۱۰ رقم باشد.");

      orders.push({
        id: Date.now(),
        productId,
        productTitle: product.title,
        price: product.price,
        name,
        phone,
        address,
        postal
      });

      alert("سفارش شما ثبت شد. شما به صفحه پرداخت منتقل می‌شوید.");

      orderModal.hide();
      document.getElementById('orderModal').remove();

      // هدایت به صفحه پرداخت زرین پال - لطفا merchant_id خود را جایگزین کنید
      const merchant_id = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"; // این مقدار را با کد مرچنت زرین پال جایگزین کنید
      const amount = product.price.replace(/[^0-9]/g, ""); // فقط اعداد قیمت
      const description = encodeURIComponent(`خرید محصول ${product.title} از نوژشاپ`);

      // درگاه زرین پال آنلاین
      const paymentUrl = `https://www.zarinpal.com/pg/StartPay/${merchant_id}?amount=${amount}&description=${description}`;

      window.open(paymentUrl, "_blank");
    };

    document.getElementById('orderModal').addEventListener('hidden.bs.modal', function () {
      document.getElementById('orderModal').remove();
    });
  }

  // نمایش سفارشات پنل مدیریت
  function renderOrders() {
    if(orders.length === 0) {
      manageOrderList.innerHTML = "<li class='list-group-item text-center'>سفارشی ثبت نشده</li>";
      return;
    }
    manageOrderList.innerHTML = "";
    orders.forEach(o => {
      const li = document.createElement("li");
      li.className = "list-group-item d-flex justify-content-between align-items-center";
      li.innerHTML = `
        <div>
          <b>محصول:</b> ${o.productTitle} | <b>قیمت:</b> ${o.price} <br />
          <b>نام:</b> ${o.name} | <b>تلفن:</b> ${o.phone} <br />
          <b>آدرس:</b> ${o.address} | <b>کد پستی:</b> ${o.postal}
        </div>
        <button class="btn btn-danger btn-sm deleteOrderBtn" data-id="${o.id}">حذف</button>
      `;
      manageOrderList.appendChild(li);
    });

    document.querySelectorAll(".deleteOrderBtn").forEach(btn => {
      btn.onclick = e => {
        const id = parseInt(e.target.dataset.id);
        orders = orders.filter(o => o.id !== id);
        renderOrders();
        alert("سفارش حذف شد");
      };
    });
  }

  // نمایش و مدیریت محصولات در پنل مدیریت
  function renderManageProducts() {
    if(products.length === 0) {
      manageProductList.innerHTML = "<li class='list-group-item text-center'>محصولی وجود ندارد</li>";
      return;
    }
    manageProductList.innerHTML = "";
    products.forEach(p => {
      const li = document.createElement("li");
      li.className = "list-group-item d-flex justify-content-between align-items-center";
      li.innerHTML = `
        <div style="flex-grow:1">
          <input type="text" class="form-control mb-1 productTitleInput" data-id="${p.id}" value="${p.title}" />
          <input type="text" class="form-control productPriceInput" data-id="${p.id}" value="${p.price}" />
          <input type="text" class="form-control productImageInput mt-1" data-id="${p.id}" value="${p.image}" />
        </div>
        <button class="btn btn-danger btn-sm deleteProductBtn" data-id="${p.id}">حذف</button>
      `;
      manageProductList.appendChild(li);
    });

    document.querySelectorAll(".deleteProductBtn").forEach(btn => {
      btn.onclick = e => {
        const id = parseInt(e.target.dataset.id);
        products = products.filter(p => p.id !== id);
        renderManageProducts();
        showProducts();
        alert("محصول حذف شد");
      };
    });

    document.querySelectorAll(".productTitleInput").forEach(input => {
      input.onchange = e => {
        const id = parseInt(e.target.dataset.id);
        const p = products.find(p => p.id === id);
        if(p) {
          p.title = e.target.value;
          showProducts();
        }
