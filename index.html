<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>نوژشاپ - فروشگاه لوازم آرایشی و بهداشتی</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
<style>
  body { background: #f9f9fb; font-family: "Tahoma", sans-serif; }
  header, footer { background-color: #d63384; color: white; padding: 1rem 0; }
  .product-img { height: 200px; object-fit: cover; border-radius: 10px; }
  .trust-logo { height: 60px; margin-left: 15px; }
  nav a.nav-link.active { font-weight: bold; color: #d63384 !important; }
  #adminPanel { display: none; }
  #loginPanel { max-width: 400px; margin: 2rem auto; }
</style>
</head>
<body>

<header class="text-center">
  <h1>نوژشاپ</h1>
  <p>فروشگاه آنلاین لوازم آرایشی و بهداشتی</p>
</header>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container">
    <a class="navbar-brand" href="#home">نوژشاپ</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
      aria-controls="navbarNav" aria-expanded="false" aria-label="نمایش فهرست">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link active" href="#home">خانه</a></li>
        <li class="nav-item"><a class="nav-link" href="#products">محصولات</a></li>
        <li class="nav-item"><a class="nav-link" href="#contact">تماس با ما</a></li>
        <li class="nav-item"><a class="nav-link" href="#" id="adminBtn">مدیریت سایت</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container my-4">

  <!-- بخش خانه -->
  <section id="home" class="mb-5 text-center">
    <h2>به نوژشاپ خوش آمدید!</h2>
    <p style="max-width: 600px; margin: auto; font-size: 1.1rem; color: #555;">
      تو نوژشاپ، ما باور داریم زیبایی حق همه‌ست.  
      محصولات باکیفیت و تازه‌ترین برندهای آرایشی و بهداشتی رو با قیمت مناسب براتون فراهم کردیم.  
      تیم ما همیشه آماده‌ست تا بهترین‌ها رو به دست شما برسونه و تجربه خریدی راحت و لذت‌بخش داشته باشید.  
      با نوژشاپ، درخشش و سلامت پوست و مو رو به خودتون هدیه بدید!  
    </p>
  </section>

  <!-- بخش محصولات -->
  <section id="products" class="mb-5">
    <h2 class="mb-4 text-center">محصولات ما</h2>
    <div class="row g-4" id="productList">
      <!-- محصولات اینجا با JS اضافه میشن -->
    </div>
  </section>

  <!-- فرم سفارش (پنهان پیش‌فرض) -->
  <section id="orderSection" style="display:none;">
    <h2 class="mb-4 text-center">فرم ثبت سفارش</h2>
    <form id="orderForm" class="mx-auto" style="max-width: 500px;">
      <div class="mb-3">
        <label for="orderProduct" class="form-label">محصول</label>
        <input type="text" id="orderProduct" class="form-control" readonly />
      </div>
      <div class="mb-3">
        <label for="orderPrice" class="form-label">قیمت واحد (تومان)</label>
        <input type="number" id="orderPrice" class="form-control" readonly />
      </div>
      <div class="mb-3">
        <label for="orderCount" class="form-label">تعداد</label>
        <input type="number" id="orderCount" class="form-control" min="1" value="1" required />
      </div>
      <div class="mb-3">
        <label for="customerName" class="form-label">نام و نام خانوادگی</label>
        <input type="text" id="customerName" class="form-control" required minlength="3" />
      </div>
      <div class="mb-3">
        <label for="customerPhone" class="form-label">شماره تماس</label>
        <input type="tel" id="customerPhone" class="form-control" required pattern="^[0-9]{10,15}$" title="فقط اعداد وارد کنید" />
      </div>
      <div class="mb-3">
        <label for="customerAddress" class="form-label">آدرس کامل</label>
        <textarea id="customerAddress" class="form-control" rows="2" required minlength="5"></textarea>
      </div>
      <div class="mb-3">
        <label for="customerPostal" class="form-label">کد پستی</label>
        <input type="text" id="customerPostal" class="form-control" required pattern="^[0-9]{10}$" title="کد پستی باید ۱۰ رقم باشد" />
      </div>
      <button type="submit" class="btn btn-success w-100">ثبت سفارش و پرداخت</button>
      <button type="button" id="cancelOrder" class="btn btn-secondary w-100 mt-2">انصراف</button>
    </form>
  </section>

  <!-- بخش سفارشات مدیریت -->
  <section id="ordersSection" style="display:none;" class="mb-5">
    <h2 class="mb-4 text-center">سفارشات ثبت شده</h2>
    <ul class="list-group" id="manageOrderList"></ul>
  </section>

  <!-- پنل ورود مدیریت -->
  <section id="loginPanel">
    <h3 class="text-center">ورود مدیریت</h3>
    <input type="password" id="adminPassword" class="form-control mb-3" placeholder="رمز عبور را وارد کنید" />
    <button id="loginBtn" class="btn btn-danger w-100">ورود</button>
    <p id="loginError" class="text-danger mt-2" style="display:none;">رمز عبور اشتباه است.</p>
  </section>

  <!-- پنل مدیریت -->
  <section id="adminPanel" class="mb-5" style="display:none;">
    <h2 class="mb-4 text-center">پنل مدیریت</h2>

    <div class="mb-4">
      <h4>افزودن محصول جدید</h4>
      <input type="text" id="newTitle" class="form-control mb-2" placeholder="نام محصول" />
      <input type="number" id="newPrice" class="form-control mb-2" placeholder="قیمت (تومان)" min="1" />
      <input type="text" id="newImage" class="form-control mb-2" placeholder="لینک تصویر" />
      <button id="addProductBtn" class="btn btn-success">افزودن محصول</button>
    </div>

    <div>
      <h4>مدیریت محصولات</h4>
      <ul class="list-group" id="manageProductList"></ul>
    </div>

    <div class="mt-4">
      <h4>سفارشات ثبت شده</h4>
      <ul class="list-group" id="manageOrderListPanel"></ul>
    </div>

    <button id="logoutBtn" class="btn btn-secondary mt-4">خروج از مدیریت</button>
  </section>

</main>

<footer class="text-center">
  <div class="container d-flex justify-content-center align-items-center flex-wrap">
    <img src="https://trustseal.enamad.ir/logo.aspx?id=124674&amp;Code=e5LfFkIfiWLnlq2FrP01" 
         alt="نماد اعتماد الکترونیکی" class="trust-logo" />
    <span>© ۲۰۲۵ نوژشاپ - تمامی حقوق محفوظ است</span>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  let products = [
    {id: 1, title: "کرم مرطوب‌کننده", price: 250000, image: "https://cdn.pixabay.com/photo/2016/03/27/21/17/cosmetics-1284258_1280.jpg"},
    {id: 2, title: "رژ لب مایع مات", price: 150000, image: "https://cdn.pixabay.com/photo/2018/03/06/22/20/lipstick-3209793_1280.jpg"},
    {id: 3, title: "سرم ویتامین C", price: 320000, image: "https://cdn.pixabay.com/photo/2017/07/10/19/02/serum-2497527_1280.jpg"},
    {id: 4, title: "ادو پرفیوم زنانه", price: 400000, image: "https://cdn.pixabay.com/photo/2016/11/18/16/40/perfume-1835611_1280.jpg"},
    {id: 5, title: "ماسک صورت", price: 180000, image: "https://cdn.pixabay.com/photo/2017/12/10/14/47/facial-mask-3015523_1280.jpg"},
    {id: 6, title: "لاک ناخن رنگی", price: 90000, image: "https://cdn.pixabay.com/photo/2016/03/23/20/26/nail-polish-1274889_1280.jpg"},
  ];

  let orders = [];

  const productList = document.getElementById("productList");
  const orderSection = document.getElementById("orderSection");
  const orderForm = document.getElementById("orderForm");
  const manageOrderList = document.getElementById("manageOrderList");
  const manageOrderListPanel = document.getElementById("manageOrderListPanel");
  const manageProductList = document.getElementById("manageProductList");
  const adminPanel = document.getElementById("adminPanel");
  const loginPanel = document.getElementById("loginPanel");
  const loginBtn = document.getElementById("loginBtn");
  const adminPasswordInput = document.getElementById("adminPassword");
  const loginError = document.getElementById("loginError");
  const adminBtn = document.getElementById("adminBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const cancelOrderBtn = document.getElementById("cancelOrder");

  let selectedProduct = null;

  // نمایش محصولات
  function showProducts() {
    productList.innerHTML = "";
    products.forEach(p => {
      const div = document.createElement("div");
      div.className = "col-12 col-md-4";
      div.innerHTML = `
        <div class="card shadow-sm">
          <img src="${p.image}" class="card-img-top product-img" alt="${p.title}" />
          <div class="card-body text-center">
            <h5 class="card-title">${p.title}</h5>
            <p class="card-text text-danger fw-bold">${p.price.toLocaleString()} تومان</p>
            <button class="btn btn-danger buyBtn" data-id="${p.id}">خرید</button>
          </div>
        </div>`;
      productList.appendChild(div);
    });
    document.querySelectorAll(".buyBtn").forEach(btn => {
      btn.onclick = e => {
        const id = parseInt(e.target.dataset.id);
        startOrder(id);
      };
    });
  }

  // شروع سفارش: نمایش فرم با داده محصول انتخاب شده
  function startOrder(productId) {
    selectedProduct = products.find(p => p.id === productId);
    if (!selectedProduct) return alert("محصول یافت نشد");

    document.getElementById("orderProduct").value = selectedProduct.title;
    document.getElementById("orderPrice").value = selectedProduct.price;
    document.getElementById("orderCount").value = 1;
    document.getElementById("customerName").value = "";
    document.getElementById("customerPhone").value = "";
    document.getElementById("customerAddress").value = "";
    document.getElementById("customerPostal").value = "";

    orderSection.style.display = "block";
    window.scrollTo({top: orderSection.offsetTop, behavior: "smooth"});
  }

  // لغو سفارش و مخفی کردن فرم
  cancelOrderBtn.onclick = () => {
    orderSection.style.display = "none";
  };

  // ثبت سفارش و هدایت به درگاه پرداخت
  orderForm.onsubmit = function(e) {
    e.preventDefault();

    const count = parseInt(document.getElementById("orderCount").value);
    if (isNaN(count) || count < 1) {
      alert("تعداد باید عددی بزرگ‌تر یا مساوی ۱ باشد.");
      return;
    }

    const name = document.getElementById("customerName").value.trim();
    const phone = document.getElementById("customerPhone").value.trim();
    const address = document.getElementById("customerAddress").value.trim();
    const postal = document.getElementById("customerPostal").value.trim();

    if (name.length < 3) { alert("نام باید حداقل ۳ حرف باشد."); return; }
    if (!/^[0-9]{10,15}$/.test(phone)) { alert("شماره تماس معتبر نیست."); return; }
    if (address.length < 5) { alert("آدرس کامل را وارد کنید."); return; }
    if (!/^[0-9]{10}$/.test(postal)) { alert("کد پستی باید ۱۰ رقم باشد."); return; }

    const totalPrice = selectedProduct.price * count;

    orders.push({
      id: Date.now(),
      productId: selectedProduct.id,
      productTitle: selectedProduct.title,
      price: selectedProduct.price,
      count,
      name,
      phone,
      address,
      postal
    });

    alert("سفارش شما ثبت شد. شما به صفحه پرداخت منتقل می‌شوید.");

    orderSection.style.display = "none";

    // صفحه پرداخت زرین پال (merchant_id را با مقدار خودت جایگزین کن)
    const merchant_id = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx";
    const amount = totalPrice;
    const description = encodeURIComponent(`خرید ${count} عدد ${selectedProduct.title} از نوژشاپ`);

    const paymentUrl = `https://www.zarinpal.com/pg/StartPay/${merchant_id}?amount=${amount}&description=${description}`;

    window.open(paymentUrl, "_blank");
  };

  // نمایش سفارشات پنل مدیریت
  function renderOrders() {
    if(orders.length === 0) {
      manageOrderList.innerHTML = "<li class='list-group-item text-center'>سفارشی ثبت نشده</li>";
      manageOrderListPanel.innerHTML = "<li class='list-group-item text-center'>سفارشی ثبت نشده</li>";
      return;
    }
    manageOrderList.innerHTML = "";
    manageOrderListPanel.innerHTML = "";
    orders.forEach(o => {
      const li = document.createElement("li");
      li.className = "list-group-item d-flex justify-content-between align-items-center flex-wrap";
      li.innerHTML = `
        <div style="min-width: 60%">
          <b>محصول:</b> ${o.productTitle} (${o.count} عدد) | <b>قیمت واحد:</b> ${o.price.toLocaleString()} تومان <br />
          <b>نام:</b> ${o.name} | <b>تلفن:</b> ${o.phone} <br />
          <b>آدرس:</b> ${o.address} | <b>کد پستی:</b> ${o.postal}
        </div>
        <button class="btn btn-danger btn-sm deleteOrderBtn" data-id="${o.id}">حذف</button>
      `;
      manageOrderList.appendChild(li);

      // همون سفارش رو تو پنل هم نمایش بده
      const li2 = li.cloneNode(true);
      manageOrderListPanel.appendChild(li2);
    });

    document.querySelectorAll(".deleteOrderBtn").forEach(btn => {
      btn.onclick = e => {
        const id = parseInt(e.target.dataset.id);
        orders = orders.filter(o => o.id !== id);
        renderOrders();
        alert("سفارش حذف شد");
      };
    });
  }

  // مدیریت محصولات در پنل مدیریت
  function renderManageProducts() {
    if(products.length === 0) {
      manageProductList.innerHTML = "<li class='list-group-item text-center'>محصولی وجود ندارد</li>";
      return;
    }
    manageProductList.innerHTML = "";
    products.forEach(p => {
      const li = document.createElement("li");
      li.className = "list-group-item d-flex justify-content-between align-items-center flex-wrap";
      li.innerHTML = `
        <div style="flex-grow:1; min-width: 60%;">
          <input type="text" class="form-control mb-1 productTitleInput" data-id="${p.id}" value="${p.title}" />
          <input type="number" class="form-control productPriceInput" data-id="${p.id}" value="${p.price}" min="1" />
